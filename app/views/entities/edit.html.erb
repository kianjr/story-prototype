<h1>Editing Entity</h1>

<svg viewBox="-50 -50 100 100">
  <g id="layers"></g>
</svg>

<div id="shapeSelectors"></div>

<script>
  var width = d3.select("body").node().getBoundingClientRect().width
  data = JSON.parse(<%= raw @entity.json.to_json %>)
  var svg = d3.select("svg")
    .attr("height", width)
    .attr("width", width)

  var layers = d3.select("#layers")
    .selectAll('g')
    .data(data.layers)
    .enter()
    .append('g')

  var shapes = layers
    .selectAll('path')
    .data((d) => d.shapes)
    .enter()
    .append('path')
    .attr("d", (d) => d.path)
    .attr("transform", (d) => `translate(${d.x} ${d.y}) scale(${d.scale})`)
    .on("click", selectActive)
    .call(d3.drag()
        .on("drag", dragged)
        .on("end", dragEnd))

  function dragged(event, d) {
      // Update the position with the delta x and y applied by the drag:
      d.x += event.dx;
      d.y += event.dy;
      d3.select(this)
        .attr("transform", (d) => `translate(${d.x} ${d.y}) scale(${d.scale})`)
        .classed("dragging", true)
    }

  function dragEnd(event, d) {
      d3.select(this)
        .classed("dragging", false)
    }

  function selectActive(event, d){
    }
</script>

<%= render 'form', entity: @entity %>

<%= link_to 'Show', @entity %> |
<%= link_to 'Back', entities_path %>
